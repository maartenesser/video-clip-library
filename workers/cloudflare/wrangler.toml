# Wrangler configuration for Cloudflare Containers
name = "video-processing-pipeline"
main = "src/worker.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Container configuration (using Durable Objects)
# Using performance instance for larger video processing (400MB+)
[[containers]]
class_name = "VideoProcessor"
image = "./Dockerfile"
max_instances = 5
instance_type = "performance"

# Durable Objects binding for the container
[[durable_objects.bindings]]
name = "VIDEO_PROCESSOR"
class_name = "VideoProcessor"

# Migrations for Durable Objects
[[migrations]]
tag = "v1"
new_sqlite_classes = ["VideoProcessor"]

# Environment variables (set via wrangler secret)
[vars]
ENVIRONMENT = "production"

# Observability configuration
[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1

# R2 bucket binding
[[r2_buckets]]
binding = "VIDEO_BUCKET"
bucket_name = "video-clips"

# Secrets (configured via `wrangler secret put`)
# - OPENAI_API_KEY
# - R2_ACCESS_KEY_ID
# - R2_SECRET_ACCESS_KEY
# - WEBHOOK_SECRET
# - SUPABASE_URL
# - SUPABASE_SERVICE_KEY
